apiVersion: krateo.io/v1alpha1
kind: KrateoPlatformOps
metadata:
  annotations:
    "krateo.io/connector-verbose": "true"
    "helm.sh/hook": post-install,post-upgrade
  name: krateo
  namespace: {{ .Release.Namespace }}
spec:
  steps:

    # beginning of .Values.krateoplatformops.composableportal.enabled
    {{- if .Values.krateoplatformops.composableportal.enabled }}
    - id: create-jwt-sign-key
      type: object
      with:
        apiVersion: v1
        kind: Secret
        metadata:
          name: jwt-sign-key
        set:
          - name: type
            value: Opaque
          - name: stringData.JWT_SIGN_KEY
            value: {{ randAlphaNum 12 | quote }}

    - id: install-authn
      type: chart
      with:
        name: {{ .Values.krateoplatformops.authn.chart.name }}
        version: {{ .Values.krateoplatformops.authn.chart.version }}
        repository: {{ .Values.krateoplatformops.authn.chart.repository }}
        wait: {{ .Values.krateoplatformops.authn.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.authn.chart.waitTimeout }}
        {{- if and (hasKey .Values.krateoplatformops.authn.chart "credentials") (gt (len .Values.krateoplatformops.authn.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.authn.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.authn.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.authn.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.authn.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.authn.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.authn.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.authn.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.authn.resources.requests .Values.krateoplatformops.authn.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.authn.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.authn.resources.requests .Values.krateoplatformops.authn.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.authn.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.authn.resources.limits .Values.krateoplatformops.authn.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.authn.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.authn.resources.limits .Values.krateoplatformops.authn.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.authn.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.authn.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.authn.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.authn.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.authn.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.authn.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.authn.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.authn.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.authn.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.authn.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.authn.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.authn.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.authn.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.authn.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.authn.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.authn.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "capabilities") (hasKey .Values.krateoplatformops.authn.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.authn.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "capabilities") (hasKey .Values.krateoplatformops.authn.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.authn.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.authn.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.authn.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.authn.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.authn.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.authn.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.authn.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.authn.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.authn.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.authn.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.authn.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.authn.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.authn.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.authn.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.authn.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.authn.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.authn.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.authn.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "hostProcess") (hasKey .Values.krateoplatformops.authn.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.authn.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.authn.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.authn.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.authn.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.authn.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.authn.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.authn.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.authn.image.tag }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.authn.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.authn.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30082"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.authn.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.authn.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.authn.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.authn.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.authn.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.authn.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.authn.tls (gt (len .Values.krateoplatformops.ingress.authn.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.authn.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.authn.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          - name: env.AUTHN_KUBECONFIG_SERVER_URL
            value: {{ .Values.krateoplatformops.authn.KUBECONFIG_SERVER_URL }}
          - name: {{ .Values.krateoplatformops.authn.env }}
          {{- if .Values.krateoplatformops.authn.env }}
          {{- range $key, $value := .Values.krateoplatformops.authn.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    {{- if and (eq .Values.krateoplatformops.service.type "NodePort") .Values.krateoplatformops.service.externalIpAvailable }}
    # to implement: $(kubectl get nodes --namespace krateo-system -o jsonpath="{.items[0].status.addresses[0].address}")
    - id: extract-authn-nodeport-ip
      type: var
      with:
        name: AUTHN_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .spec.ports[0].nodePort

    - id: extract-authn-nodeport-port
      type: var
      with:
        name: AUTHN_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if and (eq .Values.krateoplatformops.service.type "NodePort") (not .Values.krateoplatformops.service.externalIpAvailable) }}
    - id: extract-authn-nodeport-port
      type: var
      with:
        name: AUTHN_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}

    {{- if .Values.krateoplatformops.service.externalIpAvailable }}
    - id: extract-authn-lb-ip
      type: var
      with:
        name: AUTHN_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip
    {{- else }}
    - id: extract-authn-lb-ip
      type: var
      with:
        name: AUTHN_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .status.loadBalancer.ingress[0].hostname
    {{- end }}

    - id: extract-authn-lb-port
      type: var
      with:
        name: AUTHN_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .spec.ports[0].port

    {{- else if .Values.krateoplatformops.ingress.enabled }}
    - id: extract-authn-ingress-ip
      type: var
      with:
        name: AUTHN_IP
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip

    - id: extract-authn-ingress-host
      type: var
      with:
        name: AUTHN_INGRESS_HOST
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.authn.fullnameOverride }}
            name: {{ .Values.krateoplatformops.authn.fullnameOverride }}
            {{- else }}
            name: authn
            {{- end }}
          selector: .spec.rules[0].host
    {{- end }}

    - id: install-smithery
      type: chart
      with:
        name: {{ .Values.krateoplatformops.smithery.chart.name }}
        version: {{ .Values.krateoplatformops.smithery.chart.version }}
        repository: {{ .Values.krateoplatformops.smithery.chart.repository }}
        wait: {{ .Values.krateoplatformops.smithery.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.smithery.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.smithery.chart.credentials (gt (len .Values.krateoplatformops.smithery.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.smithery.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.smithery.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.smithery.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.smithery.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.smithery.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.smithery.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.smithery.resources.requests .Values.krateoplatformops.smithery.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.smithery.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.smithery.resources.requests .Values.krateoplatformops.smithery.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.smithery.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.smithery.resources.limits .Values.krateoplatformops.smithery.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.smithery.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.smithery.resources.limits .Values.krateoplatformops.smithery.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.smithery.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.smithery.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.smithery.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.smithery.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.smithery.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.smithery.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.smithery.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.smithery.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.smithery.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.smithery.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "capabilities") (hasKey .Values.krateoplatformops.smithery.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.smithery.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "capabilities") (hasKey .Values.krateoplatformops.smithery.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.smithery.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.smithery.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.smithery.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.smithery.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.smithery.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.smithery.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.smithery.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.smithery.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.smithery.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.smithery.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.smithery.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.smithery.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.smithery.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.smithery.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.smithery.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.smithery.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.smithery.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.smithery.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "hostProcess") (hasKey .Values.krateoplatformops.smithery.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.smithery.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.smithery.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.smithery.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.smithery.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.smithery.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.smithery.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.smithery.image.tag }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.smithery.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.smithery.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30088"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.smithery.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.smithery.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.smithery.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.smithery.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.smithery.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.smithery.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.smithery.tls (gt (len .Values.krateoplatformops.ingress.smithery.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.smithery.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.smithery.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.smithery.env }}
          {{- range $key, $value := .Values.krateoplatformops.smithery.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    {{- if and (eq .Values.krateoplatformops.service.type "NodePort") .Values.krateoplatformops.service.externalIpAvailable }}
    # to implement: $(kubectl get nodes --namespace krateo-system -o jsonpath="{.items[0].status.addresses[0].address}")
    - id: extract-smithery-nodeport-ip
      type: var
      with:
        name: SMITHERY_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .spec.ports[0].nodePort

    - id: extract-smithery-nodeport-port
      type: var
      with:
        name: SMITHERY_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if and (eq .Values.krateoplatformops.service.type "NodePort") (not .Values.krateoplatformops.service.externalIpAvailable) }}
    - id: extract-smithery-nodeport-port
      type: var
      with:
        name: SMITHERY_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}

    {{- if .Values.krateoplatformops.service.externalIpAvailable }}
    - id: extract-smithery-lb-ip
      type: var
      with:
        name: SMITHERY_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip
    {{- else }}
    - id: extract-smithery-lb-ip
      type: var
      with:
        name: SMITHERY_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .status.loadBalancer.ingress[0].hostname
    {{- end }}

    - id: extract-smithery-lb-port
      type: var
      with:
        name: SMITHERY_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .spec.ports[0].port
    {{- else if .Values.krateoplatformops.ingress.enabled }}
    - id: extract-smithery-ingress-ip
      type: var
      with:
        name: SMITHERY_IP
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip

    - id: extract-smithery-ingress-host
      type: var
      with:
        name: SMITHERY_INGRESS_HOST
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.smithery.fullnameOverride }}
            name: {{ .Values.krateoplatformops.smithery.fullnameOverride }}
            {{- else }}
            name: smithery
            {{- end }}
          selector: .spec.rules[0].host
    {{- end }}

    - id: install-snowplow
      type: chart
      with:
        name: {{ .Values.krateoplatformops.snowplow.chart.name }}
        version: {{ .Values.krateoplatformops.snowplow.chart.version }}
        repository: {{ .Values.krateoplatformops.snowplow.chart.repository }}
        wait: {{ .Values.krateoplatformops.snowplow.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.snowplow.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.snowplow.chart.credentials (gt (len .Values.krateoplatformops.snowplow.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.snowplow.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.snowplow.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.snowplow.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.snowplow.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.snowplow.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.snowplow.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.snowplow.resources.requests .Values.krateoplatformops.snowplow.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.snowplow.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.snowplow.resources.requests .Values.krateoplatformops.snowplow.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.snowplow.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.snowplow.resources.limits .Values.krateoplatformops.snowplow.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.snowplow.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.snowplow.resources.limits .Values.krateoplatformops.snowplow.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.snowplow.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.snowplow.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.snowplow.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.snowplow.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.snowplow.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.snowplow.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.snowplow.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.snowplow.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.snowplow.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.snowplow.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "capabilities") (hasKey .Values.krateoplatformops.snowplow.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.snowplow.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "capabilities") (hasKey .Values.krateoplatformops.snowplow.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.snowplow.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.snowplow.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.snowplow.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.snowplow.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.snowplow.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.snowplow.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.snowplow.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.snowplow.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.snowplow.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.snowplow.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.snowplow.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.snowplow.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.snowplow.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.snowplow.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "hostProcess") (hasKey .Values.krateoplatformops.snowplow.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.snowplow.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.snowplow.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.snowplow.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.snowplow.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.snowplow.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.snowplow.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.snowplow.image.tag }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.snowplow.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.snowplow.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30081"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.snowplow.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.snowplow.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.snowplow.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.snowplow.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.snowplow.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.snowplow.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.snowplow.tls (gt (len .Values.krateoplatformops.ingress.snowplow.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.snowplow.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.snowplow.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.snowplow.env }}
          {{- range $key, $value := .Values.krateoplatformops.snowplow.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    {{- if and (eq .Values.krateoplatformops.service.type "NodePort") .Values.krateoplatformops.service.externalIpAvailable }}
    # to implement: $(kubectl get nodes --namespace krateo-system -o jsonpath="{.items[0].status.addresses[0].address}")
    - id: extract-snowplow-nodeport-ip
      type: var
      with:
        name: SNOWPLOW_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .spec.ports[0].nodePort

    - id: extract-snowplow-nodeport-port
      type: var
      with:
        name: SNOWPLOW_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if and (eq .Values.krateoplatformops.service.type "NodePort") (not .Values.krateoplatformops.service.externalIpAvailable) }}
    - id: extract-snowplow-nodeport-port
      type: var
      with:
        name: SNOWPLOW_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}

    {{- if .Values.krateoplatformops.service.externalIpAvailable }}
    - id: extract-snowplow-lb-ip
      type: var
      with:
        name: SNOWPLOW_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip
    {{- else }}
    - id: extract-snowplow-lb-ip
      type: var
      with:
        name: SNOWPLOW_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .status.loadBalancer.ingress[0].hostname
    {{- end }}

    - id: extract-snowplow-lb-port
      type: var
      with:
        name: SNOWPLOW_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .spec.ports[0].port
    {{- else if .Values.krateoplatformops.ingress.enabled }}
    - id: extract-snowplow-ingress-ip
      type: var
      with:
        name: SNOWPLOW_IP
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip

    - id: extract-snowplow-ingress-host
      type: var
      with:
        name: SNOWPLOW_INGRESS_HOST
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.snowplow.fullnameOverride }}
            name: {{ .Values.krateoplatformops.snowplow.fullnameOverride }}
            {{- else }}
            name: snowplow
            {{- end }}
          selector: .spec.rules[0].host
    {{- end }}    

    # beginning of if or .Values.krateoplatformops.composableportal.enabled .Values.krateoplatformops.composablefinops.enabled
    {{- if or .Values.krateoplatformops.composableportal.enabled .Values.krateoplatformops.composablefinops.enabled }}

    - id: install-eventrouter
      type: chart
      with:
        name: {{ .Values.krateoplatformops.eventrouter.chart.name }}
        version: {{ .Values.krateoplatformops.eventrouter.chart.version }}
        repository: {{ .Values.krateoplatformops.eventrouter.chart.repository }}
        wait: {{ .Values.krateoplatformops.eventrouter.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.eventrouter.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.eventrouter.chart.credentials (gt (len .Values.krateoplatformops.eventrouter.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.eventrouter.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.eventrouter.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.eventrouter.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.eventrouter.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.eventrouter.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.eventrouter.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventrouter.resources.requests .Values.krateoplatformops.eventrouter.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.eventrouter.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventrouter.resources.requests .Values.krateoplatformops.eventrouter.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.eventrouter.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventrouter.resources.limits .Values.krateoplatformops.eventrouter.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.eventrouter.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventrouter.resources.limits .Values.krateoplatformops.eventrouter.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.eventrouter.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.eventrouter.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.eventrouter.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventrouter.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventrouter.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventrouter.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventrouter.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "capabilities") (hasKey .Values.krateoplatformops.eventrouter.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.eventrouter.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "capabilities") (hasKey .Values.krateoplatformops.eventrouter.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.eventrouter.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventrouter.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventrouter.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventrouter.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "hostProcess") (hasKey .Values.krateoplatformops.eventrouter.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventrouter.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventrouter.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventrouter.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.eventrouter.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.eventrouter.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.eventrouter.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.eventrouter.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventrouter.env }}
          {{- range $key, $value := .Values.krateoplatformops.eventrouter.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    # end of if or .Values.krateoplatformops.composableportal.enabled .Values.krateoplatformops.composablefinops.enabled
    {{- end }}

    - id: install-eventsse-etcd
      type: chart
      with:
        name: {{ .Values.krateoplatformops.eventsse.etcd.chart.name }}
        releaseName: {{ .Values.krateoplatformops.eventsse.etcd.chart.releaseName }}
        version: {{ .Values.krateoplatformops.eventsse.etcd.chart.version }}
        repository: {{ .Values.krateoplatformops.eventsse.etcd.chart.repository }}
        wait: {{ .Values.krateoplatformops.eventsse.etcd.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.eventsse.etcd.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.eventsse.etcd.chart.credentials (gt (len .Values.krateoplatformops.eventsse.etcd.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.eventsse.etcd.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.eventsse.etcd.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.eventsse.etcd.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.eventsse.etcd.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.eventsse.etcd.auth.rbac.create }}
          - name: auth.rbac.create
            value: "true"
          {{- else }}
          - name: auth.rbac.create
            value: "false"
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.global.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.eventsse.etcd.global.imagePullSecrets }}
          - name: global.imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.global.compatibility.openshift.adaptSecurityContext }}
          - name: global.compatibility.openshift.adaptSecurityContext
            value: {{ .Values.krateoplatformops.eventsse.etcd.global.compatibility.openshift.adaptSecurityContext }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.global.imageRegistry }}
          - name: global.imageRegistry
            value: {{ .Values.krateoplatformops.eventsse.etcd.global.imageRegistry }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.global.defaultStorageClass }}
          - name: global.defaultStorageClass
            value: {{ .Values.krateoplatformops.eventsse.etcd.global.defaultStorageClass }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.eventsse.etcd.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.resources.requests .Values.krateoplatformops.eventsse.etcd.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.eventsse.etcd.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.resources.requests .Values.krateoplatformops.eventsse.etcd.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.eventsse.etcd.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.resources.limits .Values.krateoplatformops.eventsse.etcd.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.eventsse.etcd.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.resources.limits .Values.krateoplatformops.eventsse.etcd.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.eventsse.etcd.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.etcd.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.eventsse.etcd.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventsse.etcd.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.allowPrivilegeEscalation }}
          - name: containerSecurityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.appArmorProfile "localhostProfile") }}
          - name: containerSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.appArmorProfile "type") }}
          - name: containerSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "capabilities") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.capabilities.add }}
          - name: containerSecurityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "capabilities") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.capabilities.drop }}
          - name: containerSecurityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.privileged }}
          - name: containerSecurityContext.privileged
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.procMount }}
          - name: containerSecurityContext.procMount
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.readOnlyRootFilesystem }}
          - name: containerSecurityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.runAsGroup }}
          - name: containerSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.runAsNonRoot }}
          - name: containerSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.runAsUser }}
          - name: containerSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions "level") }}
          - name: containerSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions "role") }}
          - name: containerSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions "type") }}
          - name: containerSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions "user") }}
          - name: containerSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seccompProfile "localhostProfile") }}
          - name: containerSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seccompProfile "type") }}
          - name: containerSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: containerSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.windowsOptions "hostProcess") }}
          - name: containerSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.windowsOptions "runAsUserName") }}
          - name: containerSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventsse.etcd.containerSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.eventsse.etcd.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.eventsse.etcd.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.eventsse.etcd.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.env }}
          {{- range $index, $key := keys .Values.krateoplatformops.eventsse.etcd.env }}
          - name: extraEnvVars[{{ $index }}].name
            value: {{ $key | quote }}
          - name: extraEnvVars[{{ $index }}].value
            value: {{ index $.Values.krateoplatformops.eventsse.etcd.env $key | quote }}
          {{- end }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.requests .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.requests.cpu }}
          - name: preUpgradeJob.resources.requests.cpu
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.requests .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.requests.memory }}
          - name: preUpgradeJob.resources.requests.memory
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.limits .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.limits.cpu }}
          - name: preUpgradeJob.resources.limits.cpu
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.limits .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.limits.memory }}
          - name: preUpgradeJob.resources.limits.memory
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: preUpgradeJob.podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.appArmorProfile "type") }}
          - name: preUpgradeJob.podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.fsGroup }}
          - name: preUpgradeJob.podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.fsGroupChangePolicy }}
          - name: preUpgradeJob.podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.runAsGroup }}
          - name: preUpgradeJob.podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.runAsNonRoot }}
          - name: preUpgradeJob.podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.runAsUser }}
          - name: preUpgradeJob.podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions "level") }}
          - name: preUpgradeJob.podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions "role") }}
          - name: preUpgradeJob.podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions "type") }}
          - name: preUpgradeJob.podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions "user") }}
          - name: preUpgradeJob.podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: preUpgradeJob.podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seccompProfile "type") }}
          - name: preUpgradeJob.podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.supplementalGroups }}
          - name: preUpgradeJob.podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.supplementalGroupsPolicy }}
          - name: preUpgradeJob.podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.sysctls }}
          - name: preUpgradeJob.podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: preUpgradeJob.podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.windowsOptions "hostProcess") }}
          - name: preUpgradeJob.podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: preUpgradeJob.podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.allowPrivilegeEscalation }}
          - name: preUpgradeJob.containerSecurityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.appArmorProfile "localhostProfile") }}
          - name: preUpgradeJob.containerSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.appArmorProfile "type") }}
          - name: preUpgradeJob.containerSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "capabilities") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.capabilities.add }}
          - name: preUpgradeJob.containerSecurityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "capabilities") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.capabilities.drop }}
          - name: preUpgradeJob.containerSecurityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.privileged }}
          - name: preUpgradeJob.containerSecurityContext.privileged
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.procMount }}
          - name: preUpgradeJob.containerSecurityContext.procMount
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.readOnlyRootFilesystem }}
          - name: preUpgradeJob.containerSecurityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.runAsGroup }}
          - name: preUpgradeJob.containerSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.runAsNonRoot }}
          - name: preUpgradeJob.containerSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.runAsUser }}
          - name: preUpgradeJob.containerSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions "level") }}
          - name: preUpgradeJob.containerSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions "role") }}
          - name: preUpgradeJob.containerSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions "type") }}
          - name: preUpgradeJob.containerSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions "user") }}
          - name: preUpgradeJob.containerSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seccompProfile "localhostProfile") }}
          - name: preUpgradeJob.containerSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seccompProfile "type") }}
          - name: preUpgradeJob.containerSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: preUpgradeJob.containerSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.windowsOptions "hostProcess") }}
          - name: preUpgradeJob.containerSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.windowsOptions "runAsUserName") }}
          - name: preUpgradeJob.containerSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventsse.etcd.preUpgradeJob.containerSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}

    - id: install-eventsse
      type: chart
      with:
        name: {{ .Values.krateoplatformops.eventsse.chart.name }}
        version: {{ .Values.krateoplatformops.eventsse.chart.version }}
        repository: {{ .Values.krateoplatformops.eventsse.chart.repository }}
        wait: {{ .Values.krateoplatformops.eventsse.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.eventsse.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.eventsse.chart.credentials (gt (len .Values.krateoplatformops.eventsse.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.eventsse.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.eventsse.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.eventsse.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.eventsse.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.etcd.fullnameOverride }}
          - name: etcd.service.name
            value: {{ .Values.krateoplatformops.eventsse.etcd.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.resources.requests .Values.krateoplatformops.eventsse.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.eventsse.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.resources.requests .Values.krateoplatformops.eventsse.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.eventsse.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.resources.limits .Values.krateoplatformops.eventsse.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.eventsse.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.eventsse.resources.limits .Values.krateoplatformops.eventsse.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.eventsse.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.eventsse.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventsse.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventsse.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.eventsse.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.eventsse.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.eventsse.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "capabilities") (hasKey .Values.krateoplatformops.eventsse.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "capabilities") (hasKey .Values.krateoplatformops.eventsse.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.eventsse.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.eventsse.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.eventsse.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.eventsse.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.eventsse.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.eventsse.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.eventsse.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.eventsse.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.eventsse.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.eventsse.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.eventsse.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.eventsse.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.eventsse.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "hostProcess") (hasKey .Values.krateoplatformops.eventsse.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.eventsse.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.eventsse.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.eventsse.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.eventsse.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.eventsse.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.eventsse.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.eventsse.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.eventsse.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.eventsse.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.eventsse.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30083"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.eventsse.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.eventsse.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.eventsse.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.eventsse.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.eventsse.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.eventsse.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.eventsse.tls (gt (len .Values.krateoplatformops.ingress.eventsse.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.eventsse.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.eventsse.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.env }}
          {{- range $key, $value := .Values.krateoplatformops.eventsse.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    {{- if and (eq .Values.krateoplatformops.service.type "NodePort") .Values.krateoplatformops.service.externalIpAvailable }}
    # to implement: $(kubectl get nodes --namespace krateo-system -o jsonpath="{.items[0].status.addresses[0].address}")
    - id: extract-eventsse-nodeport-ip
      type: var
      with:
        name: EVENTSSE_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-external
            {{- else }}
            name: eventsse-external
            {{- end }}
          selector: .spec.ports[0].nodePort

    - id: extract-eventsse-nodeport-port
      type: var
      with:
        name: EVENTSSE_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-external
            {{- else }}
            name: eventsse-external
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if and (eq .Values.krateoplatformops.service.type "NodePort") (not .Values.krateoplatformops.service.externalIpAvailable) }}
    - id: extract-eventsse-nodeport-port
      type: var
      with:
        name: EVENTSSE_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-external
            {{- else }}
            name: eventsse-external
            {{- end }}
          selector: .spec.ports[0].nodePort

    {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}

    {{- if .Values.krateoplatformops.service.externalIpAvailable }}
    - id: extract-eventsse-lb-ip
      type: var
      with:
        name: EVENTSSE_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-external
            {{- else }}
            name: eventsse-external
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip
    {{- else }}
    - id: extract-eventsse-lb-ip
      type: var
      with:
        name: EVENTSSE_IP
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-external
            {{- else }}
            name: eventsse-external
            {{- end }}
          selector: .status.loadBalancer.ingress[0].hostname
    {{- end }}

    - id: extract-eventsse-lb-port
      type: var
      with:
        name: EVENTSSE_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-external
            {{- else }}
            name: eventsse-external
            {{- end }}
          selector: .spec.ports[0].port
    {{- else if .Values.krateoplatformops.ingress.enabled }}
    - id: extract-eventsse-ingress-ip
      type: var
      with:
        name: EVENTSSE_IP
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}
            {{- else }}
            name: eventsse
            {{- end }}
          selector: .status.loadBalancer.ingress[0].ip

    - id: extract-eventsse-ingress-host
      type: var
      with:
        name: EVENTSSE_INGRESS_HOST
        valueFrom:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}
            {{- else }}
            name: eventsse
            {{- end }}
          selector: .spec.rules[0].host
    {{- end }}

    - id: install-frontend
      type: chart
      with:
        name: {{ .Values.krateoplatformops.frontend.chart.name }}
        version: {{ .Values.krateoplatformops.frontend.chart.version }}
        repository: {{ .Values.krateoplatformops.frontend.chart.repository }}
        wait: {{ .Values.krateoplatformops.frontend.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.frontend.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.frontend.chart.credentials (gt (len .Values.krateoplatformops.frontend.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.frontend.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.frontend.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.frontend.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.frontend.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.frontend.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.frontend.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.frontend.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.frontend.resources.requests .Values.krateoplatformops.frontend.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.frontend.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.frontend.resources.requests .Values.krateoplatformops.frontend.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.frontend.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.frontend.resources.limits .Values.krateoplatformops.frontend.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.frontend.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.frontend.resources.limits .Values.krateoplatformops.frontend.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.frontend.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.frontend.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.frontend.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.frontend.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.frontend.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.frontend.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.frontend.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.frontend.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.frontend.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.frontend.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "capabilities") (hasKey .Values.krateoplatformops.frontend.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.frontend.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "capabilities") (hasKey .Values.krateoplatformops.frontend.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.frontend.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.frontend.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.frontend.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.frontend.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.frontend.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.frontend.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.frontend.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.frontend.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.frontend.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.frontend.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.frontend.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.frontend.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.frontend.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.frontend.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.frontend.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.frontend.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.frontend.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.frontend.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "hostProcess") (hasKey .Values.krateoplatformops.frontend.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.frontend.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.frontend.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.frontend.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.frontend.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.frontend.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.frontend.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.frontend.image.tag }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.frontend.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.frontend.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30080"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.frontend.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.frontend.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.frontend.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.frontend.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.frontend.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.frontend.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.frontend.tls (gt (len .Values.krateoplatformops.ingress.frontend.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.frontend.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.frontend.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.overrideconf }}
          - name: config.AUTHN_API_BASE_URL
            value: {{ .Values.krateoplatformops.frontend.config.AUTHN_API_BASE_URL }}
          - name: config.SNOWPLOW_API_BASE_URL
            value: {{ .Values.krateoplatformops.frontend.config.SNOWPLOW_API_BASE_URL }}
          - name: config.EVENTS_PUSH_API_BASE_URL
            value: {{ .Values.krateoplatformops.frontend.config.EVENTS_PUSH_API_BASE_URL }}
          - name: config.EVENTS_API_BASE_URL
            value: {{ .Values.krateoplatformops.frontend.config.EVENTS_API_BASE_URL }}
          - name: config.SMITHERY_API_BASE_URL
            value: {{ .Values.krateoplatformops.frontend.config.SMITHERY_API_BASE_URL }}
          {{- else if and (eq .Values.krateoplatformops.service.type "NodePort") .Values.krateoplatformops.service.externalIpAvailable }}
          - name: config.AUTHN_API_BASE_URL
            value: http://$AUTHN_IP:$AUTHN_PORT
          - name: config.SNOWPLOW_API_BASE_URL
            value: http://$SNOWPLOW_IP:$SNOWPLOW_PORT
          - name: config.EVENTS_PUSH_API_BASE_URL
            value: http://$EVENTSSE_IP:$EVENTSSE_PORT
          - name: config.EVENTS_API_BASE_URL
            value: http://$EVENTSSE_IP:$EVENTSSE_PORT
          - name: config.SMITHERY_API_BASE_URL
            value: http://$SMITHERY_IP:$SMITHERY_PORT
          {{- else if and (eq .Values.krateoplatformops.service.type "NodePort") (not .Values.krateoplatformops.service.externalIpAvailable) }}
          - name: config.AUTHN_API_BASE_URL
            value: http://127.0.0.1:$AUTHN_PORT
          - name: config.SNOWPLOW_API_BASE_URL
            value: http://127.0.0.1:$SNOWPLOW_PORT
          - name: config.EVENTS_PUSH_API_BASE_URL
            value: http://127.0.0.1:$EVENTSSE_PORT
          - name: config.EVENTS_API_BASE_URL
            value: http://127.0.0.1:$EVENTSSE_PORT
          - name: config.SMITHERY_API_BASE_URL
            value: http://127.0.0.1:$SMITHERY_PORT
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: config.AUTHN_API_BASE_URL
            value: http://$AUTHN_IP:$AUTHN_PORT
          - name: config.SNOWPLOW_API_BASE_URL
            value: http://$SNOWPLOW_IP:$SNOWPLOW_PORT
          - name: config.EVENTS_PUSH_API_BASE_URL
            value: http://$EVENTSSE_IP:$EVENTSSE_PORT
          - name: config.EVENTS_API_BASE_URL
            value: http://$EVENTSSE_IP:$EVENTSSE_PORT
          - name: config.SMITHERY_API_BASE_URL
            value: http://$SMITHERY_IP:$SMITHERY_PORT
          {{- else if .Values.krateoplatformops.ingress.enabled }}
          - name: config.AUTHN_API_BASE_URL
            value: https://$AUTHN_INGRESS_HOST
          - name: config.SNOWPLOW_API_BASE_URL
            value: https://$SNOWPLOW_INGRESS_HOST
          - name: config.EVENTS_PUSH_API_BASE_URL
            value: https://$EVENTSSE_INGRESS_HOST
          - name: config.EVENTS_API_BASE_URL
            value: https://$EVENTSSE_INGRESS_HOST
          - name: config.SMITHERY_API_BASE_URL
            value: http://$SMITHERY_INGRESS_HOST
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.env }}
          {{- range $key, $value := .Values.krateoplatformops.frontend.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.config.INIT }}
          - name: config.INIT
            value: {{ .Values.krateoplatformops.frontend.config.INIT }}&namespace={{ .Release.Namespace }}
          {{- else }}
          - name: config.INIT
            value: /call?resource=navmenus&apiVersion=widgets.templates.krateo.io/v1beta1&name=sidebar-nav-menu&namespace={{ .Release.Namespace }}
          {{- end }}
          {{- if .Values.krateoplatformops.frontend.config.ROUTES_LOADER }}
          - name: config.ROUTES_LOADER
            value: {{ .Values.krateoplatformops.frontend.config.ROUTES_LOADER }}&namespace={{ .Release.Namespace }}
          {{- else }}
          - name: config.ROUTES_LOADER
            value: /call?resource=routesloaders&apiVersion=widgets.templates.krateo.io/v1beta1&name=routes-loader&namespace={{ .Release.Namespace }}
          {{- end }}

    - id: extract-eventsse-internal-port
      type: var
      with:
        name: EVENTSSE_INTERNAL_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
            name: {{ .Values.krateoplatformops.eventsse.fullnameOverride }}-internal
            {{- else }}
            name: eventsse-internal
            {{- end }}
          selector: .spec.ports[0].port

    - id: install-resource-tree-handler
      type: chart
      with:
        name: {{ .Values.krateoplatformops.resourcetreehandler.chart.name }}
        version: {{ .Values.krateoplatformops.resourcetreehandler.chart.version }}
        repository: {{ .Values.krateoplatformops.resourcetreehandler.chart.repository }}
        wait: {{ .Values.krateoplatformops.resourcetreehandler.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.resourcetreehandler.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.resourcetreehandler.chart.credentials (gt (len .Values.krateoplatformops.resourcetreehandler.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.resourcetreehandler.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.resourcetreehandler.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.resourcetreehandler.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.resourcetreehandler.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.resourcetreehandler.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.resourcetreehandler.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.resourcetreehandler.resources.requests .Values.krateoplatformops.resourcetreehandler.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.resourcetreehandler.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.resourcetreehandler.resources.requests .Values.krateoplatformops.resourcetreehandler.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.resourcetreehandler.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.resourcetreehandler.resources.limits .Values.krateoplatformops.resourcetreehandler.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.resourcetreehandler.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.resourcetreehandler.resources.limits .Values.krateoplatformops.resourcetreehandler.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.resourcetreehandler.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.resourcetreehandler.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.resourcetreehandler.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.resourcetreehandler.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "capabilities") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.resourcetreehandler.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "capabilities") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.resourcetreehandler.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "hostProcess") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.resourcetreehandler.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.resourcetreehandler.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.resourcetreehandler.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.resourcetreehandler.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.resourcetreehandler.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.resourcetreehandler.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.resourcetreehandler.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.resourcetreehandler.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30085"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- with .Values.krateoplatformops.resourcetreehandler.service.annotations }}
          {{- range $key, $value := .Values.krateoplatformops.resourcetreehandler.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.resourcetreehandler.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.resourcetreehandler.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.resourcetreehandler.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.resourcetreehandler.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.resourcetreehandler.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.resourcetreehandler.tls (gt (len .Values.krateoplatformops.ingress.resourcetreehandler.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.resourcetreehandler.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.resourcetreehandler.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.eventsse.fullnameOverride }}
          - name: env.URL_SSE
            value: http://{{ .Values.krateoplatformops.eventsse.fullnameOverride }}.{{ .Release.Namespace }}.svc.cluster.local:$EVENTSSE_INTERNAL_PORT/notifications
          {{- else }}
          - name: env.URL_SSE
            value: http://eventsse-internal.{{ .Release.Namespace }}.svc.cluster.local:$EVENTSSE_INTERNAL_PORT/notifications
          {{- end }}
          {{- if .Values.krateoplatformops.resourcetreehandler.env }}
          {{- range $key, $value := .Values.krateoplatformops.resourcetreehandler.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    # beginning of .Values.krateoplatformops.composableportalstarter.enabled
    {{- if .Values.krateoplatformops.composableportalstarter.enabled }}
    - id: install-composable-portal-starter
      type: chart
      with:
        name: {{ .Values.krateoplatformops.composableportalstarter.chart.name }}
        version: {{ .Values.krateoplatformops.composableportalstarter.chart.version }}
        repository: {{ .Values.krateoplatformops.composableportalstarter.chart.repository }}
        wait: {{ .Values.krateoplatformops.composableportalstarter.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.composableportalstarter.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.composableportalstarter.chart.credentials (gt (len .Values.krateoplatformops.composableportalstarter.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.composableportalstarter.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.composableportalstarter.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.composableportalstarter.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.composableportalstarter.chart.credentials.passwordRef.namespace }}
        {{- end }}

    # end of .Values.krateoplatformops.composableportalstarter.enabled
    {{- end }}

    # end of .Values.krateoplatformops.composableportal.enabled
    {{- end }} 

    # beginning of .Values.krateoplatformops.composableoperations.enabled
    {{- if .Values.krateoplatformops.composableoperations.enabled }}
    - id: install-core-provider
      type: chart
      with:
        name: {{ .Values.krateoplatformops.coreprovider.chart.name }}
        version: {{ .Values.krateoplatformops.coreprovider.chart.version }}
        repository: {{ .Values.krateoplatformops.coreprovider.chart.repository }}
        wait: {{ .Values.krateoplatformops.coreprovider.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.coreprovider.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.coreprovider.chart.credentials (gt (len .Values.krateoplatformops.coreprovider.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.coreprovider.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.coreprovider.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.coreprovider.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.coreprovider.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.coreprovider.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.coreprovider.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.coreprovider.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.resources.requests .Values.krateoplatformops.coreprovider.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.coreprovider.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.resources.requests .Values.krateoplatformops.coreprovider.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.coreprovider.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.resources.limits .Values.krateoplatformops.coreprovider.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.coreprovider.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.resources.limits .Values.krateoplatformops.coreprovider.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.coreprovider.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.coreprovider.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.coreprovider.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.coreprovider.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "capabilities") (hasKey .Values.krateoplatformops.coreprovider.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "capabilities") (hasKey .Values.krateoplatformops.coreprovider.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.coreprovider.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "hostProcess") (hasKey .Values.krateoplatformops.coreprovider.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.coreprovider.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.coreprovider.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.coreprovider.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.coreprovider.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.coreprovider.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.env }}
          {{- range $key, $value := .Values.krateoplatformops.coreprovider.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.coreprovider.cdc.imagePullSecrets }}
          - name: cdc.imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.fullnameOverride }}
          - name: cdc.fullnameOverride
            value: {{ .Values.krateoplatformops.coreprovider.cdc.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.cdc.resources.requests .Values.krateoplatformops.coreprovider.cdc.resources.requests.cpu }}
          - name: cdc.resources.requests.cpu
            value: {{ .Values.krateoplatformops.coreprovider.cdc.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.cdc.resources.requests .Values.krateoplatformops.coreprovider.cdc.resources.requests.memory }}
          - name: cdc.resources.requests.memory
            value: {{ .Values.krateoplatformops.coreprovider.cdc.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.cdc.resources.limits .Values.krateoplatformops.coreprovider.cdc.resources.limits.cpu }}
          - name: cdc.resources.limits.cpu
            value: {{ .Values.krateoplatformops.coreprovider.cdc.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.cdc.resources.limits .Values.krateoplatformops.coreprovider.cdc.resources.limits.memory }}
          - name: cdc.resources.limits.memory
            value: {{ .Values.krateoplatformops.coreprovider.cdc.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: cdc.podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.appArmorProfile "type") }}
          - name: cdc.podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.fsGroup }}
          - name: cdc.podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.fsGroupChangePolicy }}
          - name: cdc.podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.runAsGroup }}
          - name: cdc.podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.runAsNonRoot }}
          - name: cdc.podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.runAsUser }}
          - name: cdc.podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions "level") }}
          - name: cdc.podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions "role") }}
          - name: cdc.podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions "type") }}
          - name: cdc.podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions "user") }}
          - name: cdc.podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: cdc.podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seccompProfile "type") }}
          - name: cdc.podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.supplementalGroups }}
          - name: cdc.podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.supplementalGroupsPolicy }}
          - name: cdc.podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.sysctls }}
          - name: cdc.podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: cdc.podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.windowsOptions "hostProcess") }}
          - name: cdc.podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: cdc.podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.coreprovider.cdc.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.allowPrivilegeEscalation }}
          - name: cdc.securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.appArmorProfile "localhostProfile") }}
          - name: cdc.securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.appArmorProfile "type") }}
          - name: cdc.securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "capabilities") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.cdc.securityContext.capabilities.add }}
          - name: cdc.securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "capabilities") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.cdc.securityContext.capabilities.drop }}
          - name: cdc.securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.privileged }}
          - name: cdc.securityContext.privileged
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.procMount }}
          - name: cdc.securityContext.procMount
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.readOnlyRootFilesystem }}
          - name: cdc.securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.runAsGroup }}
          - name: cdc.securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.runAsNonRoot }}
          - name: cdc.securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.securityContext.runAsUser }}
          - name: cdc.securityContext.runAsUser
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions "level") }}
          - name: cdc.securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions "role") }}
          - name: cdc.securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions "type") }}
          - name: cdc.securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions "user") }}
          - name: cdc.securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.seccompProfile "localhostProfile") }}
          - name: cdc.securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.seccompProfile "type") }}
          - name: cdc.securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: cdc.securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "hostProcess") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.windowsOptions "hostProcess") }}
          - name: cdc.securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.coreprovider.cdc.securityContext.windowsOptions "runAsUserName") }}
          - name: cdc.securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.coreprovider.cdc.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.image.repository }}
          - name: cdc.image.repository
            value: {{ .Values.krateoplatformops.coreprovider.cdc.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.image.pullPolicy }}
          - name: cdc.image.pullPolicy
            value: {{ .Values.krateoplatformops.coreprovider.cdc.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.image.tag }}
          - name: cdc.image.tag
            value: {{ .Values.krateoplatformops.coreprovider.cdc.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.cdc.env }}
          {{- range $key, $value := .Values.krateoplatformops.coreprovider.cdc.env }}
          - name: cdc.env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.coreprovider.chartInspector.imagePullSecrets }}
          - name: chartInspector.imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.fullnameOverride }}
          - name: chartInspector.fullnameOverride
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.chartInspector.resources.requests .Values.krateoplatformops.coreprovider.chartInspector.resources.requests.cpu }}
          - name: chartInspector.resources.requests.cpu
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.chartInspector.resources.requests .Values.krateoplatformops.coreprovider.chartInspector.resources.requests.memory }}
          - name: chartInspector.resources.requests.memory
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.chartInspector.resources.limits .Values.krateoplatformops.coreprovider.chartInspector.resources.limits.cpu }}
          - name: chartInspector.resources.limits.cpu
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.coreprovider.chartInspector.resources.limits .Values.krateoplatformops.coreprovider.chartInspector.resources.limits.memory }}
          - name: chartInspector.resources.limits.memory
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: chartInspector.podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.appArmorProfile "type") }}
          - name: chartInspector.podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.fsGroup }}
          - name: chartInspector.podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.fsGroupChangePolicy }}
          - name: chartInspector.podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.runAsGroup }}
          - name: chartInspector.podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.runAsNonRoot }}
          - name: chartInspector.podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.runAsUser }}
          - name: chartInspector.podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions "level") }}
          - name: chartInspector.podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions "role") }}
          - name: chartInspector.podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions "type") }}
          - name: chartInspector.podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions "user") }}
          - name: chartInspector.podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: chartInspector.podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seccompProfile "type") }}
          - name: chartInspector.podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.supplementalGroups }}
          - name: chartInspector.podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.supplementalGroupsPolicy }}
          - name: chartInspector.podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.sysctls }}
          - name: chartInspector.podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: chartInspector.podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.windowsOptions "hostProcess") }}
          - name: chartInspector.podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: chartInspector.podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.allowPrivilegeEscalation }}
          - name: chartInspector.securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.appArmorProfile "localhostProfile") }}
          - name: chartInspector.securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.appArmorProfile "type") }}
          - name: chartInspector.securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "capabilities") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.chartInspector.securityContext.capabilities.add }}
          - name: chartInspector.securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "capabilities") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.coreprovider.chartInspector.securityContext.capabilities.drop }}
          - name: chartInspector.securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.privileged }}
          - name: chartInspector.securityContext.privileged
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.procMount }}
          - name: chartInspector.securityContext.procMount
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.readOnlyRootFilesystem }}
          - name: chartInspector.securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.runAsGroup }}
          - name: chartInspector.securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.runAsNonRoot }}
          - name: chartInspector.securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.securityContext.runAsUser }}
          - name: chartInspector.securityContext.runAsUser
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions "level") }}
          - name: chartInspector.securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions "role") }}
          - name: chartInspector.securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions "type") }}
          - name: chartInspector.securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions "user") }}
          - name: chartInspector.securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seccompProfile "localhostProfile") }}
          - name: chartInspector.securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seccompProfile "type") }}
          - name: chartInspector.securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: chartInspector.securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "hostProcess") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.windowsOptions "hostProcess") }}
          - name: chartInspector.securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.coreprovider.chartInspector.securityContext.windowsOptions "runAsUserName") }}
          - name: chartInspector.securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.image.repository }}
          - name: chartInspector.image.repository
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.image.pullPolicy }}
          - name: chartInspector.image.pullPolicy
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.image.tag }}
          - name: chartInspector.image.tag
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.env }}
          {{- range $key, $value := .Values.krateoplatformops.coreprovider.chartInspector.env }}
          - name: chartInspector.env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}          
          {{- if .Values.krateoplatformops.coreprovider.chartInspector.replicaCount }}
          - name: chartInspector.replicaCount
            value: {{ .Values.krateoplatformops.coreprovider.chartInspector.replicaCount | quote }}
          {{- end }}

    # end of .Values.krateoplatformops.composableoperations.enabled
    {{- end }}

    # beginning of .Values.krateoplatformops.oasgenprovider.enabled
    {{- if .Values.krateoplatformops.oasgenprovider.enabled }}

    - id: install-oasgen-provider
      type: chart
      with:
        name: {{ .Values.krateoplatformops.oasgenprovider.chart.name }}
        version: {{ .Values.krateoplatformops.oasgenprovider.chart.version }}
        repository: {{ .Values.krateoplatformops.oasgenprovider.chart.repository }}
        wait: {{ .Values.krateoplatformops.oasgenprovider.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.oasgenprovider.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.oasgenprovider.chart.credentials (gt (len .Values.krateoplatformops.oasgenprovider.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.oasgenprovider.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.oasgenprovider.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.oasgenprovider.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.oasgenprovider.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.oasgenprovider.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.oasgenprovider.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.oasgenprovider.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.resources.requests .Values.krateoplatformops.oasgenprovider.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.oasgenprovider.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.resources.requests .Values.krateoplatformops.oasgenprovider.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.oasgenprovider.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.resources.limits .Values.krateoplatformops.oasgenprovider.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.oasgenprovider.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.resources.limits .Values.krateoplatformops.oasgenprovider.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.oasgenprovider.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.oasgenprovider.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.oasgenprovider.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.oasgenprovider.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.oasgenprovider.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "capabilities") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.oasgenprovider.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "capabilities") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.oasgenprovider.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "hostProcess") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.oasgenprovider.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.oasgenprovider.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.oasgenprovider.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.oasgenprovider.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.oasgenprovider.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.env }}
          {{- range $key, $value := .Values.krateoplatformops.oasgenprovider.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.oasgenprovider.rdc.imagePullSecrets }}
          - name: rdc.imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.fullnameOverride }}
          - name: rdc.fullnameOverride
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.rdc.resources.requests .Values.krateoplatformops.oasgenprovider.rdc.resources.requests.cpu }}
          - name: rdc.resources.requests.cpu
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.rdc.resources.requests .Values.krateoplatformops.oasgenprovider.rdc.resources.requests.memory }}
          - name: rdc.resources.requests.memory
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.rdc.resources.limits .Values.krateoplatformops.oasgenprovider.rdc.resources.limits.cpu }}
          - name: rdc.resources.limits.cpu
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.oasgenprovider.rdc.resources.limits .Values.krateoplatformops.oasgenprovider.rdc.resources.limits.memory }}
          - name: rdc.resources.limits.memory
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: rdc.podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.appArmorProfile "type") }}
          - name: rdc.podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.fsGroup }}
          - name: rdc.podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.fsGroupChangePolicy }}
          - name: rdc.podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.runAsGroup }}
          - name: rdc.podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.runAsNonRoot }}
          - name: rdc.podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.runAsUser }}
          - name: rdc.podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions "level") }}
          - name: rdc.podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions "role") }}
          - name: rdc.podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions "type") }}
          - name: rdc.podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions "user") }}
          - name: rdc.podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: rdc.podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seccompProfile "type") }}
          - name: rdc.podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.supplementalGroups }}
          - name: rdc.podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.supplementalGroupsPolicy }}
          - name: rdc.podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.sysctls }}
          - name: rdc.podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: rdc.podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.windowsOptions "hostProcess") }}
          - name: rdc.podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: rdc.podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.allowPrivilegeEscalation }}
          - name: rdc.securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.appArmorProfile "localhostProfile") }}
          - name: rdc.securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.appArmorProfile "type") }}
          - name: rdc.securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "capabilities") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.oasgenprovider.rdc.securityContext.capabilities.add }}
          - name: rdc.securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "capabilities") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.oasgenprovider.rdc.securityContext.capabilities.drop }}
          - name: rdc.securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.privileged }}
          - name: rdc.securityContext.privileged
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.procMount }}
          - name: rdc.securityContext.procMount
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.readOnlyRootFilesystem }}
          - name: rdc.securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.runAsGroup }}
          - name: rdc.securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.runAsNonRoot }}
          - name: rdc.securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.securityContext.runAsUser }}
          - name: rdc.securityContext.runAsUser
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions "level") }}
          - name: rdc.securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions "role") }}
          - name: rdc.securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions "type") }}
          - name: rdc.securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions "user") }}
          - name: rdc.securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seccompProfile "localhostProfile") }}
          - name: rdc.securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seccompProfile "type") }}
          - name: rdc.securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: rdc.securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "hostProcess") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.windowsOptions "hostProcess") }}
          - name: rdc.securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.oasgenprovider.rdc.securityContext.windowsOptions "runAsUserName") }}
          - name: rdc.securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.image.repository }}
          - name: rdc.image.repository
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.image.pullPolicy }}
          - name: rdc.image.pullPolicy
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.image.tag }}
          - name: rdc.image.tag
            value: {{ .Values.krateoplatformops.oasgenprovider.rdc.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.oasgenprovider.rdc.env }}
          {{- range $key, $value := .Values.krateoplatformops.oasgenprovider.rdc.env }}
          - name: rdc.env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    # end of .Values.krateoplatformops.oasgenprovider.enabled
    {{- end }}

    # beginning of .Values.krateoplatformops.composablefinops.enabled
    {{- if .Values.krateoplatformops.composablefinops.enabled }}

    - id: install-finops-cratedb
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopscratedb.chart.name }}
        version: {{ .Values.krateoplatformops.finopscratedb.chart.version }}
        repository: {{ .Values.krateoplatformops.finopscratedb.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopscratedb.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopscratedb.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.finopscratedb.chart.credentials (gt (len .Values.krateoplatformops.finopscratedb.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopscratedb.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopscratedb.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopscratedb.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopscratedb.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopscratedb.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopscratedb.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopscratedb.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscratedb.resources.requests .Values.krateoplatformops.finopscratedb.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopscratedb.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscratedb.resources.requests .Values.krateoplatformops.finopscratedb.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopscratedb.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscratedb.resources.limits .Values.krateoplatformops.finopscratedb.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopscratedb.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscratedb.resources.limits .Values.krateoplatformops.finopscratedb.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopscratedb.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopscratedb.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopscratedb.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopscratedb.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopscratedb.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopscratedb.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopscratedb.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscratedb.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopscratedb.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopscratedb.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopscratedb.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopscratedb.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopscratedb.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopscratedb.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.openshift }}
          - name: openshift.enabled
            value: {{ .Values.krateoplatformops.finopscratedb.openshift.enabled | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.storageClassName }}
          - name: volumeClaims[0].spec.storageClassName
            value: {{ .Values.krateoplatformops.finopscratedb.storageClassName }}
          - name: volumeClaims[0].metadata.name
            value: data
          - name: volumeClaims[0].spec.accessModes[0]
            value: ReadWriteOnce
          - name: volumeClaims[0].spec.resources.requests.storage
            value: 128Mi
          {{- end }}

    - id: install-finops-operator-exporter
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.name }}
        version: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.version }}
        repository: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.finopsoperatorexporter.chart.credentials (gt (len .Values.krateoplatformops.finopsoperatorexporter.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopsoperatorexporter.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopsoperatorexporter.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopsoperatorexporter.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorexporter.resources.requests .Values.krateoplatformops.finopsoperatorexporter.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorexporter.resources.requests .Values.krateoplatformops.finopsoperatorexporter.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorexporter.resources.limits .Values.krateoplatformops.finopsoperatorexporter.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorexporter.resources.limits .Values.krateoplatformops.finopsoperatorexporter.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorexporter.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorexporter.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsoperatorexporter.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopsoperatorexporter.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorexporter.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopsoperatorexporter.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    - id: install-finops-operator-focus
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.name }}
        version: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.version }}
        repository: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.finopsoperatorfocus.chart.credentials (gt (len .Values.krateoplatformops.finopsoperatorfocus.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopsoperatorfocus.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopsoperatorfocus.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopsoperatorfocus.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorfocus.resources.requests .Values.krateoplatformops.finopsoperatorfocus.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorfocus.resources.requests .Values.krateoplatformops.finopsoperatorfocus.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorfocus.resources.limits .Values.krateoplatformops.finopsoperatorfocus.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorfocus.resources.limits .Values.krateoplatformops.finopsoperatorfocus.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorfocus.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorfocus.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsoperatorfocus.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopsoperatorfocus.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorfocus.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopsoperatorfocus.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    - id: install-finops-database-handler
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.name }}
        version: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.version }}
        repository: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.finopsdatabasehandler.chart.credentials (gt (len .Values.krateoplatformops.finopsdatabasehandler.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopsdatabasehandler.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandler.resources.requests .Values.krateoplatformops.finopsdatabasehandler.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandler.resources.requests .Values.krateoplatformops.finopsdatabasehandler.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandler.resources.limits .Values.krateoplatformops.finopsdatabasehandler.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandler.resources.limits .Values.krateoplatformops.finopsdatabasehandler.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsdatabasehandler.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsdatabasehandler.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandler.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopsdatabasehandler.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.service.type "NodePort" }}
          - name: service.type
            value: NodePort
          {{- if .Values.krateoplatformops.finopsdatabasehandler.service.nodePort }}
          - name: service.nodePort
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.service.nodePort | quote }}
          {{- else }}
          - name: service.nodePort
            value: "30086"
          {{- end }}
          {{- else if eq .Values.krateoplatformops.service.type "LoadBalancer" }}
          - name: service.type
            value: LoadBalancer
          {{- end }}
          {{- range $key, $value := .Values.krateoplatformops.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- with .Values.krateoplatformops.finopsdatabasehandler.service.annotations }}
          {{- range $key, $value := .Values.krateoplatformops.finopsdatabasehandler.service.annotations }}
          - name: service.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}
          {{- if eq .Values.krateoplatformops.ingress.enabled true }}
          - name: ingress.enabled
            value: "true"
          - name: ingress.className
            value: {{ .Values.krateoplatformops.ingress.finopsdatabasehandler.className }}
          {{- range $key, $value := .Values.krateoplatformops.ingress.finopsdatabasehandler.annotations }}
          - name: ingress.annotations.{{ $key | replace "." "\\." }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          - name: ingress.hosts[0].host
            value: {{ index .Values.krateoplatformops.ingress.finopsdatabasehandler.hosts 0 "host" }}
          - name: ingress.hosts[0].paths[0].path
            value: {{ index .Values.krateoplatformops.ingress.finopsdatabasehandler.hosts 0 "paths" 0 "path" }}
          - name: ingress.hosts[0].paths[0].pathType
            value: {{ index .Values.krateoplatformops.ingress.finopsdatabasehandler.hosts 0 "paths" 0 "pathType" }}
          {{- if and .Values.krateoplatformops.ingress.finopsdatabasehandler.tls (gt (len .Values.krateoplatformops.ingress.finopsdatabasehandler.tls) 0) }}
          - name: ingress.tls[0].secretName
            value: {{ index .Values.krateoplatformops.ingress.finopsdatabasehandler.tls 0 "secretName" }}
          - name: ingress.tls[0].hosts[0]
            value: {{ index .Values.krateoplatformops.ingress.finopsdatabasehandler.tls 0 "hosts" 0 }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscratedb.fullnameOverride }}
          - name: env.CRATE_HOST
            value: {{ .Values.krateoplatformops.finopscratedb.fullnameOverride }}.{{ .Release.Namespace }}.svc.cluster.local
          - name: cratedbUserSystemName
            value: {{ .Values.krateoplatformops.finopscratedb.fullnameOverride }}-system-credentials
          {{- else }}
          - name: env.CRATE_HOST
            value: cratedb.{{ .Release.Namespace }}.svc.cluster.local
          - name: cratedbUserSystemName
            value: cratedb-system-credentials
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopsdatabasehandler.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    - id: extract-finops-database-handler-internal-port
      type: var
      with:
        name: FINOPS_DATABASE_HANDLER_INTERNAL_PORT
        valueFrom:
          apiVersion: v1
          kind: Service
          metadata:
            {{- if .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
            name: {{ .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
            {{- else }}
            name: finops-database-handler
            {{- end }}
          selector: .spec.ports[0].port

    - id: install-finops-database-handler-uploader
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.name }}
        version: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.version }}
        repository: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.finopsdatabasehandleruploader.chart.credentials (gt (len .Values.krateoplatformops.finopsdatabasehandleruploader.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandleruploader.resources.requests .Values.krateoplatformops.finopsdatabasehandleruploader.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandleruploader.resources.requests .Values.krateoplatformops.finopsdatabasehandleruploader.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandleruploader.resources.limits .Values.krateoplatformops.finopsdatabasehandleruploader.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsdatabasehandleruploader.resources.limits .Values.krateoplatformops.finopsdatabasehandleruploader.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopsdatabasehandleruploader.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopsdatabasehandleruploader.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
          - name: env.FINOPS_DATABASE_HANDLER_ENDPOINT_NAME
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}-endpoint
          {{- else }}
          - name: env.FINOPS_DATABASE_HANDLER_ENDPOINT_NAME
            value: finops-database-handler-endpoint
          {{- end }}
          - name: env.DATABASE_CONFIG_NAMESPACE
            value: {{ .Release.Namespace }}
          {{- if .Values.krateoplatformops.finopsdatabasehandleruploader.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopsdatabasehandleruploader.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    - id: install-finops-notebooks
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopsnotebooks.chart.name }}
        version: {{ .Values.krateoplatformops.finopsnotebooks.chart.version }}
        repository: {{ .Values.krateoplatformops.finopsnotebooks.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopsnotebooks.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopsnotebooks.chart.waitTimeout }}
        {{- if and (hasKey .Values.krateoplatformops.finopsnotebooks.chart "credentials") (gt (len .Values.krateoplatformops.finopsnotebooks.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopsnotebooks.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopsnotebooks.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopsnotebooks.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopsnotebooks.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopsnotebooks.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopsnotebooks.fullnameOverride }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.fullnameOverride }}
          - name: opaReleaseName
            value: {{ .Values.krateoplatformops.opa.fullnameOverride }}
          {{- end }}

    - id: install-finops-composition-definition-parser
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.name }}
        version: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.version }}
        repository: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.waitTimeout }}
        {{- if and .Values.krateoplatformops.finopscompositiondefinitionparser.chart.credentials (gt (len .Values.krateoplatformops.finopscompositiondefinitionparser.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscompositiondefinitionparser.resources.requests .Values.krateoplatformops.finopscompositiondefinitionparser.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscompositiondefinitionparser.resources.requests .Values.krateoplatformops.finopscompositiondefinitionparser.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscompositiondefinitionparser.resources.limits .Values.krateoplatformops.finopscompositiondefinitionparser.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopscompositiondefinitionparser.resources.limits .Values.krateoplatformops.finopscompositiondefinitionparser.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopscompositiondefinitionparser.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopscompositiondefinitionparser.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
          - name: env.URL_DATABASE_HANDLER_PRICING_NOTEBOOK
            value: http://{{ .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}.{{ .Release.Namespace }}.svc.cluster.local:$FINOPS_DATABASE_HANDLER_INTERNAL_PORT/compute/pricingparser
          - name: env.DATABASE_CONFIG_NAME
            value: {{ .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
          {{- else }}
          - name: env.URL_DATABASE_HANDLER_PRICING_NOTEBOOK
            value: http://finops-database-handler.{{ .Release.Namespace }}.svc.cluster.local:$FINOPS_DATABASE_HANDLER_INTERNAL_PORT/compute/pricingparser
          - name: env.DATABASE_CONFIG_NAME
            value: finops-database-handler
          {{- end }}
          - name: env.DATABASE_CONFIG_NAMESPACE
            value: {{ .Release.Namespace }}
          {{- if .Values.krateoplatformops.finopscompositiondefinitionparser.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopscompositiondefinitionparser.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    - id: install-finops-operator-scraper
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.name }}
        version: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.version }}
        repository: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.waitTimeout }}
        {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.chart "credentials") (gt (len .Values.krateoplatformops.finopsoperatorscraper.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopsoperatorscraper.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopsoperatorscraper.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.finopsoperatorscraper.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorscraper.resources.requests .Values.krateoplatformops.finopsoperatorscraper.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorscraper.resources.requests .Values.krateoplatformops.finopsoperatorscraper.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorscraper.resources.limits .Values.krateoplatformops.finopsoperatorscraper.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.finopsoperatorscraper.resources.limits .Values.krateoplatformops.finopsoperatorscraper.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorscraper.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "capabilities") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.finopsoperatorscraper.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "hostProcess") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.finopsoperatorscraper.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.finopsoperatorscraper.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}
          - name: env.URL_DB_WEBSERVICE
            value: http://{{ .Values.krateoplatformops.finopsdatabasehandler.fullnameOverride }}.{{ .Release.Namespace }}.svc.cluster.local:$FINOPS_DATABASE_HANDLER_INTERNAL_PORT
          {{- else }}
          - name: env.URL_DB_WEBSERVICE
            value: http://finops-database-handler.{{ .Release.Namespace }}.svc.cluster.local:$FINOPS_DATABASE_HANDLER_INTERNAL_PORT
          {{- end }}
          {{- if .Values.krateoplatformops.finopsoperatorscraper.env }}
          {{- range $key, $value := .Values.krateoplatformops.finopsoperatorscraper.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    - id: install-policies
      type: chart
      with:
        name: {{ .Values.krateoplatformops.finopspolicies.chart.name }}
        version: {{ .Values.krateoplatformops.finopspolicies.chart.version }}
        repository: {{ .Values.krateoplatformops.finopspolicies.chart.repository }}
        wait: {{ .Values.krateoplatformops.finopspolicies.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.finopspolicies.chart.waitTimeout }}
        {{- if and (hasKey .Values.krateoplatformops.finopspolicies.chart "credentials") (gt (len .Values.krateoplatformops.finopspolicies.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.finopspolicies.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.finopspolicies.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.finopspolicies.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.finopspolicies.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.finopspolicies.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.finopspolicies.fullnameOverride }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.fullnameOverride }}
          - name: opaReleaseName
            value: {{ .Values.krateoplatformops.opa.fullnameOverride }}
          {{- end }}

    - id: install-opa
      type: chart
      with:
        name: {{ .Values.krateoplatformops.opa.chart.name }}
        version: {{ .Values.krateoplatformops.opa.chart.version }}
        repository: {{ .Values.krateoplatformops.opa.chart.repository }}
        wait: {{ .Values.krateoplatformops.opa.chart.wait }}
        waitTimeout: {{ .Values.krateoplatformops.opa.chart.waitTimeout }}
        {{- if and (hasKey .Values.krateoplatformops.opa.chart "credentials") (gt (len .Values.krateoplatformops.opa.chart.credentials) 0) }}
        credentials:
          username: {{ .Values.krateoplatformops.opa.chart.credentials.username }}
          passwordRef: # reference to a secret
            key: {{ .Values.krateoplatformops.opa.chart.credentials.passwordRef.key }}
            name: {{ .Values.krateoplatformops.opa.chart.credentials.passwordRef.name }}
            namespace: {{ .Values.krateoplatformops.opa.chart.credentials.passwordRef.namespace }}
        {{- end }}
        set:
          {{- if .Values.krateoplatformops.opa.imagePullSecrets }}
          {{- range $index, $secret := .Values.krateoplatformops.opa.imagePullSecrets }}
          - name: imagePullSecrets.{{ $index }}.name
            value: {{ $secret.name }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.fullnameOverride }}
          - name: fullnameOverride
            value: {{ .Values.krateoplatformops.opa.fullnameOverride }}
          {{- end }}
          {{- if and .Values.krateoplatformops.opa.resources.requests .Values.krateoplatformops.opa.resources.requests.cpu }}
          - name: resources.requests.cpu
            value: {{ .Values.krateoplatformops.opa.resources.requests.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.opa.resources.requests .Values.krateoplatformops.opa.resources.requests.memory }}
          - name: resources.requests.memory
            value: {{ .Values.krateoplatformops.opa.resources.requests.memory }}
          {{- end }}
          {{- if and .Values.krateoplatformops.opa.resources.limits .Values.krateoplatformops.opa.resources.limits.cpu }}
          - name: resources.limits.cpu
            value: {{ .Values.krateoplatformops.opa.resources.limits.cpu | quote }}
          {{- end }}
          {{- if and .Values.krateoplatformops.opa.resources.limits .Values.krateoplatformops.opa.resources.limits.memory }}
          - name: resources.limits.memory
            value: {{ .Values.krateoplatformops.opa.resources.limits.memory }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.opa.podSecurityContext.appArmorProfile "localhostProfile") }}
          - name: podSecurityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "appArmorProfile") (hasKey .Values.krateoplatformops.opa.podSecurityContext.appArmorProfile "type") }}
          - name: podSecurityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.appArmorProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.fsGroup }}
          - name: podSecurityContext.fsGroup
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.fsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.fsGroupChangePolicy }}
          - name: podSecurityContext.fsGroupChangePolicy
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.fsGroupChangePolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.runAsGroup }}
          - name: podSecurityContext.runAsGroup
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.runAsNonRoot }}
          - name: podSecurityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.runAsUser }}
          - name: podSecurityContext.runAsUser
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions "level") }}
          - name: podSecurityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions.level | replace "," "\\,"  }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions "role") }}
          - name: podSecurityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions "type") }}
          - name: podSecurityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions "user") }}
          - name: podSecurityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.opa.podSecurityContext.seccompProfile "localhostProfile") }}
          - name: podSecurityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "seccompProfile") (hasKey .Values.krateoplatformops.opa.podSecurityContext.seccompProfile "type") }}
          - name: podSecurityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.seccompProfile.type }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.supplementalGroups }}
          {{- range $index, $value := .Values.krateoplatformops.opa.podSecurityContext.supplementalGroups }}
          - name: podSecurityContext.supplementalGroups[{{ $index }}]
            value: {{ $value | quote }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.supplementalGroupsPolicy }}
          - name: podSecurityContext.supplementalGroupsPolicy
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.supplementalGroupsPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.podSecurityContext.sysctls }}
          {{- range $index, $sysctl := .Values.krateoplatformops.opa.podSecurityContext.sysctls }}
          - name: podSecurityContext.sysctls[{{ $index }}].{{ $sysctl.name }}
            value: {{ $sysctl.value | quote }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.opa.podSecurityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: podSecurityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "hostProcess") (hasKey .Values.krateoplatformops.opa.podSecurityContext.windowsOptions "hostProcess") }}
          - name: podSecurityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.podSecurityContext "windowsOptions") (hasKey .Values.krateoplatformops.opa.podSecurityContext.windowsOptions "runAsUserName") }}
          - name: podSecurityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.opa.podSecurityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.allowPrivilegeEscalation }}
          - name: securityContext.allowPrivilegeEscalation
            value: {{ .Values.krateoplatformops.opa.securityContext.allowPrivilegeEscalation | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.opa.securityContext.appArmorProfile "localhostProfile") }}
          - name: securityContext.appArmorProfile.localhostProfile
            value: {{ .Values.krateoplatformops.opa.securityContext.appArmorProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "appArmorProfile") (hasKey .Values.krateoplatformops.opa.securityContext.appArmorProfile "type") }}
          - name: securityContext.appArmorProfile.type
            value: {{ .Values.krateoplatformops.opa.securityContext.appArmorProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "capabilities") (hasKey .Values.krateoplatformops.opa.securityContext.capabilities "add") }}
          {{- range $index, $value := .Values.krateoplatformops.opa.securityContext.capabilities.add }}
          - name: securityContext.capabilities.add[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "capabilities") (hasKey .Values.krateoplatformops.opa.securityContext.capabilities "drop") }}
          {{- range $index, $value := .Values.krateoplatformops.opa.securityContext.capabilities.drop }}
          - name: securityContext.capabilities.drop[{{ $index }}]
            value: {{ $value }}
          {{- end }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.privileged }}
          - name: securityContext.privileged
            value: {{ .Values.krateoplatformops.opa.securityContext.privileged }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.procMount }}
          - name: securityContext.procMount
            value: {{ .Values.krateoplatformops.opa.securityContext.procMount }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.readOnlyRootFilesystem }}
          - name: securityContext.readOnlyRootFilesystem
            value: {{ .Values.krateoplatformops.opa.securityContext.readOnlyRootFilesystem | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.runAsGroup }}
          - name: securityContext.runAsGroup
            value: {{ .Values.krateoplatformops.opa.securityContext.runAsGroup | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.runAsNonRoot }}
          - name: securityContext.runAsNonRoot
            value: {{ .Values.krateoplatformops.opa.securityContext.runAsNonRoot | quote }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.securityContext.runAsUser }}
          - name: securityContext.runAsUser
            value: {{ .Values.krateoplatformops.opa.securityContext.runAsUser | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.securityContext.seLinuxOptions "level") }}
          - name: securityContext.seLinuxOptions.level
            value: {{ .Values.krateoplatformops.opa.securityContext.seLinuxOptions.level | replace "," "\\," }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.securityContext.seLinuxOptions "role") }}
          - name: securityContext.seLinuxOptions.role
            value: {{ .Values.krateoplatformops.opa.securityContext.seLinuxOptions.role }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.securityContext.seLinuxOptions "type") }}
          - name: securityContext.seLinuxOptions.type
            value: {{ .Values.krateoplatformops.opa.securityContext.seLinuxOptions.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "seLinuxOptions") (hasKey .Values.krateoplatformops.opa.securityContext.seLinuxOptions "user") }}
          - name: securityContext.seLinuxOptions.user
            value: {{ .Values.krateoplatformops.opa.securityContext.seLinuxOptions.user }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.opa.securityContext.seccompProfile "localhostProfile") }}
          - name: securityContext.seccompProfile.localhostProfile
            value: {{ .Values.krateoplatformops.opa.securityContext.seccompProfile.localhostProfile }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "seccompProfile") (hasKey .Values.krateoplatformops.opa.securityContext.seccompProfile "type") }}
          - name: securityContext.seccompProfile.type
            value: {{ .Values.krateoplatformops.opa.securityContext.seccompProfile.type }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "gmsaCredentialSpecName") (hasKey .Values.krateoplatformops.opa.securityContext.windowsOptions "gmsaCredentialSpecName") }}
          - name: securityContext.windowsOptions.gmsaCredentialSpecName
            value: {{ .Values.krateoplatformops.opa.securityContext.windowsOptions.gmsaCredentialSpecName }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "hostProcess") (hasKey .Values.krateoplatformops.opa.securityContext.windowsOptions "hostProcess") }}
          - name: securityContext.windowsOptions.hostProcess
            value: {{ .Values.krateoplatformops.opa.securityContext.windowsOptions.hostProcess | quote }}
          {{- end }}
          {{- if and (hasKey .Values.krateoplatformops.opa.securityContext "windowsOptions") (hasKey .Values.krateoplatformops.opa.securityContext.windowsOptions "runAsUserName") }}
          - name: securityContext.windowsOptions.runAsUserName
            value: {{ .Values.krateoplatformops.opa.securityContext.windowsOptions.runAsUserName }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.image.repository }}
          - name: image.repository
            value: {{ .Values.krateoplatformops.opa.image.repository }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.image.pullPolicy }}
          - name: image.pullPolicy
            value: {{ .Values.krateoplatformops.opa.image.pullPolicy }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.image.tag }}
          - name: image.tag
            value: {{ .Values.krateoplatformops.opa.image.tag }}
          {{- end }}
          {{- if .Values.krateoplatformops.opa.env }}
          {{- range $key, $value := .Values.krateoplatformops.opa.env }}
          - name: env.{{ $key }}
            value: {{ $value | quote }}
            asString: true
          {{- end }}
          {{- end }}

    # end of .Values.krateoplatformops.composablefinops.enabled
    {{- end }}